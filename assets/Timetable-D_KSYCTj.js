import{f as j,u as A,r as g,l as C,g as H,c as z,w as n,i as s,a as u,o as w,b as p,d as i,t as d,e as m,h as F,j as O,F as G,n as x,m as J,k as K}from"./index-C-0x0Y6P.js";const Q="/svgs/bus_stop_shelter.svg",X={style:{width:"100%",display:"flex"}},Y=p("div",{class:"flex items-center gap-2 px-1",style:{"white-space":"nowrap","text-align":"center","vertical-align":"center",display:"flex","flex-direction":"row"}},[p("img",{src:Q,style:{height:"30px",width:"30px"}})],-1),Z={style:{"white-space":"nowrap","margin-left":"10px","margin-right":"10px",color:"#FED053","user-select":"none"}},P={style:{"white-space":"nowrap","text-align":"center","vertical-align":"center"}},ee={style:{color:"#FED053","user-select":"none",margin:"5%"}},oe={__name:"Timetable",setup(te){const S=j(),I=A(),_=s("loadingInProgress"),o=s("selectedStartStation"),k=s("selectedDestinationStation"),B=s("metroBusStationsMap"),D=s("busStationsMap"),V=s("loadStationTimetables"),E=s("processTimetables"),v=s("selectedTime"),q=s("isWeekend"),h=s("toast"),b=g(!1);let T=g(null);const M=(e,a)=>{if(!a)return;if(e==="Today"){const y=o.value.timetable.findIndex(c=>c.future);if(y!==-1){let c;c=()=>{const f=a.$el.querySelectorAll(".p-datatable-selectable-row");f[y-1]?f[y-1].scrollIntoView({behavior:"auto"}):setTimeout(c,100)},c()}return}const r=a.$el.querySelectorAll(".p-datatable-selectable-row");!r||!r[0]||r[0].scrollIntoView({behavior:"auto"})},W=e=>{if(!e.data.future){h.add({severity:"error",summary:"Selected time is in the past",life:3e3});return}h.add({severity:"info",summary:"Time Selected",detail:e.data,life:3e3});const a=parseInt(S.params.stationId);I.push({name:"main",query:{startStation:a,selectedTime:v.value}})},N=e=>{e.stopImmediatePropagation(),console.log("onBusNumberClicked",e)};C(T,e=>{M(l.value,e)});const l=g("Today");C(l,e=>{M(e,T.value)});const R=g(["Today",q?"Weekdays":"Saturday / Sunday"]);H(async()=>{const e=parseInt(S.params.stationId);let a;if(D.has(e))a=D.get(e);else if(B.has(e))a=B.get(e);else{console.error(`${e} station not found in the busStationsMap and metroBusStationsMap`);return}if(!a){console.error("targetStation is null");return}console.log("on select station",a),o.value===null&&(o.value=a,o.value.timetable||(console.log("loading time table",e),_.value=!0,await V(e,o.value,E,()=>{console.error("error loading time tables",e),h.add({severity:"error",summary:"Error loading timetables",life:3e3}),_.value=!1}),console.log("timetable loaded",e),_.value=!1),k.value||(b.value=!0)),l.value!=="Today"&&(l.value="Today")});const L=()=>{const e=parseInt(S.params.stationId);I.push({name:"main",query:{startStation:e}})};return(e,a)=>{const r=u("Tag"),y=u("Marquee"),c=u("SelectButton"),f=u("Column"),U=u("DataTable"),$=u("Drawer");return w(),z($,{visible:b.value,"onUpdate:visible":a[2]||(a[2]=t=>b.value=t),onHide:L,style:{"background-color":"#1E232B"}},{header:n(()=>[p("div",X,[i(r,null,{default:n(()=>[Y]),_:1}),p("h2",Z,d(m(o).t?"Terminal":"Station")+" "+d(m(o).n),1),i(y,{id:"linesInStation",style:{width:"100%"}},{default:n(()=>[(w(!0),F(G,null,O(m(o).busses,t=>(w(),F("div",P,[i(r,{rounded:!0,value:t.n,style:x({minWidth:"40px",maxWidth:"40px",userSelect:"none",fontFamily:"TheLedDisplaySt",backgroundColor:t.c,color:t.tc})},null,8,["value","style"]),K(" "+d(t.f)+" - "+d(t.t),1)]))),256))]),_:1})])]),default:n(()=>[i(U,{ref_key:"busTable",ref:T,selection:m(v),"onUpdate:selection":a[1]||(a[1]=t=>J(v)?v.value=t:null),value:l.value==="Today"?m(o).timetable:m(o).extraTimetable,selectionMode:l.value==="Today"?"single":null,scrollable:"",scrollHeight:"flex",onRowSelect:W,style:{"background-color":"#1E232B"}},{header:n(()=>[i(c,{modelValue:l.value,"onUpdate:modelValue":a[0]||(a[0]=t=>l.value=t),options:R.value,"aria-labelledby":"basic",style:{display:"flex",width:"100%"}},null,8,["modelValue","options"])]),default:n(()=>[i(f,{header:"Bus",style:{color:"#FED053","user-select":"none"}},{body:n(t=>[i(r,{rounded:!0,onClick:N,value:t.data.n,style:x({minWidth:"40px",userSelect:"none",fontFamily:"TheLedDisplaySt",backgroundColor:t.data.c,color:t.data.tc})},null,8,["value","style"]),p("span",ee,d(t.data.to),1)]),_:1}),i(f,{header:"Time"},{body:n(t=>[p("span",{style:x(t.data.future?"color: #FED053;user-select: none;":"color: #3B3F46;user-select: none;")},d(t.data.time),5)]),_:1})]),_:1},8,["selection","value","selectionMode"])]),_:1},8,["visible"])}}};export{oe as default};
