import{f as I,u as E,r as L,g as F,c as D,w as m,i as a,a as d,o as S,h as P,t as R,e as w,d as _,j,k as H,F as N,n as V}from"./index-BeWc03P9.js";const U={__name:"Terminal",setup(W){const k=I(),i=E(),T=a("terminalsList"),y=a("currentTerminal"),p=a("loadingInProgress"),f=a("terminalsData"),x=a("loadStationTimetables"),r=a("busStationsMap"),c=a("metroBusStationsMap"),B=a("processTimetables"),M=a("toast"),u=a("selectedStartStation"),h=a("selectedDestinationStation"),g=L(!1),C=s=>{const e=s.data.i;if(console.log("terminal chosen",e),u.value===null)i.push(`/timetable/${e}`);else if(h.value===null){console.log("path finding mode");let t;if(r.has(e))t=r.get(e);else if(c.has(e))t=c.get(e);else{console.error(`${e} station not found in the busStationsMap and metroBusStationsMap`);return}if(!t){console.error("targetStation is null");return}h.value=t,i.push(`/path/${u.value.i}/${h.value.i}`)}else i.push(`/timetable/${e}`)};F(async()=>{const s=parseInt(k.params.terminalId);if(!s)return;p.value=!0;let e;for(let o=0;o<f.length;o++)if(f[o].i===s){e=f[o];break}const t=[];for(let o=0;o<e.c.length;o++){const n=e.c[o];if(!n){console.error("bad terminal choice with (no busses or no choice)",n);continue}let l;if(r.has(n.i))l=r.get(n.i);else if(c.has(n.i))l=c.get(n.i);else{console.error("bus station not found anywhere",n.i);continue}if(l.timetable){console.log("cached timetable");continue}t.push(x(n.i,l,B,()=>{console.error("error loading time tables",value.i),M.add({severity:"error",summary:"Error loading timetables",life:3e3}),p.value=!1}))}t.length>0&&await Promise.all(t),y.value=e,T.value=e.c,p.value=!1,u.value===null?g.value=!0:i.push(`/path/${u.value.i}/${s}`)});const $=()=>{i.push({name:"main"})};return(s,e)=>{const t=d("Column"),o=d("Tag"),n=d("DataTable"),l=d("Drawer");return S(),D(l,{visible:g.value,"onUpdate:visible":e[0]||(e[0]=b=>g.value=b),onHide:$,style:{"background-color":"#1E232B"}},{header:m(()=>[P(" Terminal "+R(w(y).n),1)]),default:m(()=>[_(n,{value:w(T),selectionMode:"single",scrollable:"",scrollHeight:"flex",onRowSelect:C,style:{"background-color":"#1E232B"}},{default:m(()=>[_(t,{field:"s",header:"Terminal"}),_(t,null,{body:m(b=>[(S(!0),j(N,null,H(b.data.busses,v=>(S(),D(o,{rounded:!0,value:v.n,style:V({minWidth:"40px",maxWidth:"40px",userSelect:"none",fontFamily:"TheLedDisplaySt",backgroundColor:v.c,color:v.tc})},null,8,["value","style"]))),256))]),_:1})]),_:1},8,["value"])]),_:1},8,["visible"])}}};export{U as default};
